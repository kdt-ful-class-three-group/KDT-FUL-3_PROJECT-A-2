<!DOCTYPE html>
<html lang="en">
  <head>
    <head>
      <meta charset="UTF-8" />
      <title>캔들차트 기본 예제</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <!-- * 연습을 위한 cdn 설정 -->

      <!-- 
      * chart.js : 차트용 라이브러리
      * chartjs-chart-financial : 캔들차트 플러그인
      * chartjs-adapter-date-fns : 날짜 포맷용 어댑터
    
    -->

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
      <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

      <style>
        /* body 기본값 reset */
        body {
          margin: 0;
          padding: 0;
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          background-color: #f0f0f0;
          box-sizing: border-box;
        }

        #root {
          width: 100vw;
          height: 100vh;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          box-sizing: border-box;
        }

        #candle-chart {
          width: 1000px; /* 차트 너비 */
          height: 400px; /* 차트 높이 */
          background-color: aquamarine;
        }
      </style>
    </head>
    <title>Document</title>
  </head>
  <body>
    <div id="root">
      <h1>chart.js 테스트</h1>
      <canvas id="candle-chart"></canvas>
    </div>
    <script>
      const root = document.getElementById("root");

      // * BigAnt는 임의로 만든 주식 더미데이터 작업

      const BigAnt = {
        stockData: Array.from({ length: 30 }, (_, i) => {
          const date = new Date(2025, 4, i + 1); // 2025-05-01 ~ 2025-05-30
          const open = Math.floor(Math.random() * 1000) + 1000; // 시가
          const high = open + Math.floor(Math.random() * 50); // 고가
          const low = open - Math.floor(Math.random() * 50); // 저가
          const close = Math.floor(Math.random() * (high - low)) + low; // 종가
          return { x: date, o: open, h: high, l: low, c: close };
        }),
      };

      console.log("BigAnt 큰개미 라는 뜻의 더미데이터 :", BigAnt.stockData);
      console.log(BigAnt.stockData);

      function CandleChartExample(stockData) {
        const candleChart = document.getElementById("candle-chart");
        const ctx = candleChart.getContext("2d");

        // * 캔들차트 만들때 필요한 메타데이터 객체는 주로 무엇이 필요해?

        const chartConfig = {
          type: "candlestick",
          data: {
            datasets: [
              {
                label: "BigAnt 주식 데이터",
                data: stockData,
                barThickness: 15,
                categoryPercentage: 1.0,
                barPercentage: 1.0,
              },
            ],
          },
          options: {
            responsive: true,
            scales: {

              // x 축에 무언가 값을 넣어야 하는 것이 핵심으로 보임
              x: {
                type: "time",
                time: {
                  unit: "day",
                  tooltipFormat: "yyyy-MM-dd",
                  displayFormats: {
                    day: "yyyy-MM-dd",
                  },
                },
                title: {
                  display: true,
                  text: "날짜",
                },
                ticks: {
                  source: "data", // 데이터 기반으로 눈금 생성
                  autoSkip: false, // 눈금 생략하지 않도록 설정
                },
              },
              y: {
                title: {
                  display: true,
                  text: "가격",
                },
              },
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const { o, h, l, c } = context.raw;
                    return `O: ${o}, H: ${h}, L: ${l}, C: ${c}`;
                  },
                },
              },
              legend: {
                display: false,
              },
            },
          },
        };

        new Chart(ctx, chartConfig);

        // * 실행은 잘되지만, "날짜"에 가로축에 맞게 나타나야 하는 문제가 해결되지 않음
      }
      CandleChartExample(BigAnt.stockData);
    </script>
  </body>
</html>
